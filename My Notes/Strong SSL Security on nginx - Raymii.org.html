<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455785)"/><meta name="keywords" content="Nginx, Security, SSl, Work"/><meta name="created" content="2016-07-27 15:03:09 +0000"/><meta name="source" content="web.clip"/><meta name="source-url" content="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html"/><meta name="updated" content="2016-07-27 15:03:09 +0000"/><title>Strong SSL Security on nginx - Raymii.org</title></head><body><div style="-evernote-webclip:true"><br/><div style="font-size: 16px"><div style="font-family:sans-serif;box-sizing:border-box;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="box-sizing:border-box;font-family:&quot;Open Sans&quot;, Calibri, Candara, Arial, sans-serif;font-size:15px;line-height:20px;color:rgb(85, 85, 85);background-color:rgb(255, 255, 255);"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:6966.5px;"><h2 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;width:850px;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;font-family:Raleway;">Strong SSL Security on nginx</h2><ul style="background-color:rgb(245, 245, 245);box-sizing:border-box;margin-bottom:21px;padding:8px 15px;list-style:none;border-radius:0px;margin-top:0px;border:0px none rgb(85, 85, 85);background-image:none;box-shadow:none;width:850px;height:36px;"><li style="box-sizing:border-box;display:inline-block;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:42.5px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/index.html">Home</a></li><li style="box-sizing:border-box;display:inline-block;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:79.7344px;height:20px;"><span style="padding:0px 5px;color:rgb(204, 204, 204);">/ </span><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/index.html">Tutorials</a></li><li style="box-sizing:border-box;display:inline-block;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:217.406px;height:20px;"><span style="padding:0px 5px;color:rgb(204, 204, 204);">/ </span><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html">Strong SSL Security on nginx</a></li></ul><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:21px;"><small style="font-size:85%;box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">14-06-2015</small> | <small style="font-size:85%;box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">Remy van Elst</small></p><div style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:0px;"><ins style="box-sizing:border-box;display:inline-block;width:728px;height:90px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/></div><br style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/><div style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:360.5px;"><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;">Table of Contents</h3><ol style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;padding-left:5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:320px;"><ol style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;padding-left:5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:845px;height:320px;"><ol style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;padding-left:5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:840px;height:320px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#The_BEAST_attack_and_RC4">The BEAST attack and RC4</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Factoring_RSA-EXPORT_Keys_(FREAK)">Factoring RSA-EXPORT Keys (FREAK)</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Logjam_(DH_EXPORT)">Logjam (DH EXPORT)</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Heartbleed">Heartbleed</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#SSL_Compression_(CRIME_attack)">SSL Compression (CRIME attack)</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#SSLv2_and_SSLv3">SSLv2 and SSLv3</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Poodle_and_TLS-FALLBACK-SCSV">Poodle and TLS-FALLBACK-SCSV</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#The_Cipher_Suite">The Cipher Suite</a></li><ol style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;padding-left:5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:40px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:830px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Prioritization_logic">Prioritization logic</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:830px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Mandatory_discards">Mandatory discards</a></li></ol><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Extra_settings">Extra settings</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Forward_Secrecy_&amp;_Diffie_Hellman_Ephemeral_Parameters">Forward Secrecy &amp; Diffie Hellman Ephemeral Parameters</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#OCSP_Stapling">OCSP Stapling</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#HTTP_Public_Key_Pinning_Extension">HTTP Public Key Pinning Extension</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:835px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html#Conclusion">Conclusion</a></li></ol></ol></ol></div><hr style="border-top-color:rgb(230, 230, 230);height:0px;margin-top:21px;margin-bottom:21px;border-width:1px 0px 0px;border-top-style:solid;box-sizing:border-box;border:;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"/><div style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:6278px;"><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:551px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://www.ssllabs.com/ssltest/analyze.html?d=raymii.org"><img src="Strong%20SSL%20Security%20on%20nginx%20-%20Raymii.org.resources/0A317B16-E33C-4647-935B-13A191A18E55.png" height="551" width="921"/></a></p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:100px;">This tutorial shows you how to set up strong SSL security on the nginx webserver. We do this by updating OpenSSL to the latest version to mitigate attacks like Heartbleed, disabling SSL Compression and EXPORT ciphers to mitigate attacks like FREAK, CRIME and LogJAM, disabling SSLv3 and below because of vulnerabilities in the protocol and we will set up a strong ciphersuite that enables Forward Secrecy when possible. We also enable HSTS and HPKP. This way we have a strong and future proof ssl configuration and we get an A+ on the Qually Labs SSL Test.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">I've written an Open Source <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/software/OpenSSL_Decoder.html">SSL server test</a>. You can use it to test your configuration, as an addition to the other SSL tests our there. It is fast, shows you all the information so you can make your own informed decision (no ratings), and the results are saved so you can compare different settings. You can test your site via <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://ssldecoder.org/">https://ssldecoder.org</a>.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">I've also written a handy tool which notifies you when your certificates are about to expire. It is open source so you can host it yourself internally and there is a hosted version available at <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://certificatemonitor.org/">https://certificatemonitor.org</a>.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">I've created a website with <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://cipherli.st/">Copy-pastable strong cipherssuites for NGINX, Apache, Lighttpd and other software: https://cipherli.st</a>. Handy if you don't want to read this entire tutorial. This tutorial and <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://cipherli.st/">https://cipherli.st</a> are updated continuously as new vulnerabilities are discovered.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://www.digitalocean.com/?refcode=7435ae6b8212">If you like this article, consider sponsoring me by trying out a Digital Ocean VPS. With this link you'll get a $5 VPS for 2 months free (as in, you get $10 credit). (referral link)</a></p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">This tutorial works with the stricter requirements of the SSL Labs test <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://blog.ivanristic.com/2014/01/ssl-labs-stricter-security-requirements-for-2014.html">announced on the 21st of January 2014</a> (It already did before that, if you follow(ed) it you get an A+)</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html">This tutorial is also available for Apache</a><br style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/> <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/Pass_the_SSL_Labs_Test_on_Lighttpd_%28Mitigate_the_CRIME_and_BEAST_attack_-_Disable_SSLv2_-_Enable_PFS%29.html">This tutorial is also available for Lighttpd</a><br style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/> <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://www.bsdnow.tv/episodes/2014_08_20-engineering_nginx">This tutorial is also available for FreeBSD, NetBSD and OpenBSD over at the BSD Now podcast</a></p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">You can find more info on the topics by following the links below:</p><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:140px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#BEAST_attack">BEAST Attack</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://en.wikipedia.org/wiki/CRIME_%28security_exploit%29">CRIME Attack</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://blog.cryptographyengineering.com/2015/03/attack-of-week-freak-or-factoring-nsa.html">FREAK Attack</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://heartbleed.com/">Heartbleed</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://en.wikipedia.org/wiki/Perfect_forward_secrecy">Perfect Forward Secrecy</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Dealing_with_RC4_and_BEAST">Dealing with RC4 and BEAST</a></li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://blog.cloudflare.com/logjam-the-latest-tls-vulnerability-explained/">LogJam Attack</a></li></ul><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:42px;">We are going to edit the nginx settings in the file <code style="white-space:nowrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:2px 4px;color:rgb(199, 37, 78);font-size:90%;border-radius:0px;background-color:rgb(249, 242, 244);border:0px none rgb(199, 37, 78);background-image:none;box-shadow:none;">/etc/nginx/sited-enabled/yoursite.com</code> (On Ubuntu/Debian) or in <code style="white-space:nowrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:2px 4px;color:rgb(199, 37, 78);font-size:90%;border-radius:0px;background-color:rgb(249, 242, 244);border:0px none rgb(199, 37, 78);background-image:none;box-shadow:none;">/etc/nginx/conf.d/nginx.conf</code> (On RHEL/CentOS).</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:41px;">For the entire tutorial, you need to edit the parts between the <code style="white-space:nowrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:2px 4px;color:rgb(199, 37, 78);font-size:90%;border-radius:0px;background-color:rgb(249, 242, 244);border:0px none rgb(199, 37, 78);background-image:none;box-shadow:none;">server</code> block for the server config for port 443 (ssl config). At the end of the tutorial you can find the complete config example.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><em style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">Make sure you back up the files before editing them!</em></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="The_BEAST_attack_and_RC4">The BEAST attack and RC4</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">In short, by tampering with an encryption algorithm's CBC - cipher block chaining - mode's, portions of the encrypted traffic can be secretly decrypted. More info on the above link.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:80px;">Recent browser versions have enabled client side mitigation for the beast attack. The recommendation was to disable all TLS 1.0 ciphers and only offer RC4. However, [RC4 has a growing list of attacks against it],(http://www.isg.rhul.ac.uk/tls/) many of which have crossed the line from theoretical to practical. Moreover, there is reason to believe that the NSA has broken RC4, their so-called "big breakthrough."</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:120px;">Disabling RC4 has several ramifications. One, users with shitty browsers such as Internet Explorer on Windows XP will use 3DES in lieu. Triple-DES is more secure than RC4, but it is significantly more expensive. Your server will pay the cost for these users. Two, RC4 mitigates BEAST. Thus, disabling RC4 makes TLS 1.0 users susceptible to that attack, by moving them to AES-CBC (the usual server-side BEAST "fix" is to prioritize RC4 above all else). I am confident that the flaws in RC4 significantly outweigh the risks from BEAST. Indeed, with client-side mitigation (which Chrome and Firefox both provide), BEAST is a nonissue. But the risk from RC4 only grows: More cryptanalysis will surface over time.</p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Factoring_RSA-EXPORT_Keys_(FREAK)">Factoring RSA-EXPORT Keys (FREAK)</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">FREAK is a man-in-the-middle (MITM) vulnerability discovered by a group of cryptographers at <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://www.smacktls.com/">INRIA, Microsoft Research and IMDEA</a>. FREAK stands for "Factoring RSA-EXPORT Keys."</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The vulnerability dates back to the 1990s, when the US government banned selling crypto software overseas, unless it used export cipher suites which involved encryption keys no longer than 512-bits.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:80px;">It turns out that some modern TLS clients - including Apple's SecureTransport and OpenSSL - have a bug in them. This bug causes them to accept RSA export-grade keys even when the client didn't ask for export-grade RSA. The impact of this bug can be quite nasty: it admits a 'man in the middle' attack whereby an active attacker can force down the quality of a connection, provided that the client is vulnerable and the server supports export RSA.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">There are two parts of the attack as the server must also accept "export grade RSA."</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">The MITM attack works as follows:</p><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:160px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">In the client's Hello message, it asks for a standard 'RSA' ciphersuite.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">The MITM attacker changes this message to ask for 'export RSA'.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">The server responds with a 512-bit export RSA key, signed with its long-term key.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">The client accepts this weak key due to the OpenSSL/SecureTransport bug.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">The attacker factors the RSA modulus to recover the corresponding RSA decryption key.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:40px;">When the client encrypts the 'pre-master secret' to the server, the attacker can now decrypt it to recover the TLS 'master secret'.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">From here on out, the attacker sees plaintext and can inject anything it wants.</li></ul><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The ciphersuite offered here on this page does not enable EXPORT grade ciphers. Make sure your OpenSSL is updated to the latest available version and urge your clients to also use upgraded software.</p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Logjam_(DH_EXPORT)">Logjam (DH EXPORT)</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://weakdh.org/">Researchers</a> from several universities and institutions conducted a study that found an issue in the TLS protocol. In a report the researchers report two attack methods.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">Diffie-Hellman key exchange allows that depend on TLS to agree on a shared key and negotiate a secure session over a plain text connection.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">With the first attack, a man-in-the-middle can downgrade a vulnerable TLS connection to 512-bit export-grade cryptography which would allow the attacker to read and change the data. The second threat is that many servers and use the same prime numbers for Diffie-Hellman key exchange instead of generating their own unique DH parameters.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">The team estimates that an academic team can break 768-bit primes and that a nation-state could break a 1024-bit prime. By breaking one 1024-bit prime, one could eavesdrop on 18 percent of the top one million HTTPS domains. Breaking a second prime would open up 66 percent of VPNs and 26 percent of SSH servers.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">Later on in this guide we generate our own unique DH parameters and we use a ciphersuite that does not enable EXPORT grade ciphers. Make sure your OpenSSL is updated to the latest available version and urge your clients to also use upgraded software. Updated browsers refuse DH parameters lower than 768/1024 bit as a fix to this.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://blog.cloudflare.com/logjam-the-latest-tls-vulnerability-explained/">Cloudflare has a detailed guide</a> on logjam.</p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Heartbleed">Heartbleed</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:120px;">Heartbleed is a security bug disclosed in April 2014 in the OpenSSL cryptography library, which is a widely used implementation of the Transport Layer Security (TLS) protocol. Heartbleed may be exploited regardless of whether the party using a vulnerable OpenSSL instance for TLS is a server or a client. It results from improper input validation (due to a missing bounds check) in the implementation of the DTLS heartbeat extension (RFC6520), thus the bug's name derives from "heartbeat". The vulnerability is classified as a buffer over-read, a situation where more data can be read than should be allowed.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">What versions of the OpenSSL are affected by Heartbleed?</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">Status of different versions:</p><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:80px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 1.0.1 through 1.0.1f (inclusive) are vulnerable</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 1.0.1g is NOT vulnerable</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 1.0.0 branch is NOT vulnerable</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 0.9.8 branch is NOT vulnerable</li></ul><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The bug was introduced to OpenSSL in December 2011 and has been out in the wild since OpenSSL release 1.0.1 on 14th of March 2012. OpenSSL 1.0.1g released on 7th of April 2014 fixes the bug.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">By updating OpenSSL you are not vulnerable to this bug.</p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="SSL_Compression_(CRIME_attack)">SSL Compression (CRIME attack)</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The CRIME attack uses SSL Compression to do its magic. SSL compression is turned off by default in nginx 1.1.6+/1.0.9+ (if OpenSSL 1.0.0+ used) and nginx 1.3.2+/1.2.2+ (if older versions of OpenSSL are used).</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">If you are using al earlier version of nginx or OpenSSL and your distro has not backported this option then you need to recompile OpenSSL without ZLIB support. This will disable the use of OpenSSL using the DEFLATE compression method. If you do this then you can still use regular HTML DEFLATE compression.</p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="SSLv2_and_SSLv3">SSLv2 and SSLv3</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">SSL v2 is insecure, so we need to disable it. We also disable SSLv3, as TLS 1.0 suffers a downgrade attack, allowing an attacker to force a connection to use SSLv3 and therefore disable forward secrecy.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">Again edit the config file:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:42px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
</code></pre><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Poodle_and_TLS-FALLBACK-SCSV">Poodle and TLS-FALLBACK-SCSV</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">SSLv3 allows exploiting of the <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/articles/Check_servers_for_the_Poodle_bug.html">POODLE</a> bug. This is one more major reason to disable this.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">Google have proposed an extension to SSL/TLS named <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://tools.ietf.org/html/draft-ietf-tls-downgrade-scsv-00">TLS<em style="box-sizing:border-box;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">FALLBACK</em>SCSV</a> that seeks to prevent forced SSL downgrades. This is automatically enabled if you upgrade OpenSSL to the following versions:</p><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 1.0.1 has TLS<em style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">FALLBACK</em>SCSV in 1.0.1j and higher.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 1.0.0 has TLS<em style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">FALLBACK</em>SCSV in 1.0.0o and higher.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">OpenSSL 0.9.8 has TLS<em style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">FALLBACK</em>SCSV in 0.9.8zc and higher.</li></ul><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://wiki.nginx.org/HttpSslModule#ssl_protocols">More info on the NGINX documentation</a></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="The_Cipher_Suite">The Cipher Suite</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">Forward Secrecy ensures the integrity of a session key in the event that a long-term key is compromised. PFS accomplishes this by enforcing the derivation of a new key for each and every session.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">This means that when the private key gets compromised it cannot be used to decrypt recorded SSL traffic.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The cipher suites that provide Perfect Forward Secrecy are those that use an ephemeral form of the Diffie-Hellman key exchange. Their disadvantage is their overhead, which can be improved by using the elliptic curve variants.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">The following two ciphersuites are recommended by me, and the latter by <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://wiki.mozilla.org/Security/Server_Side_TLS">the Mozilla Foundation</a>.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">The recommended cipher suite:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:42px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
</code></pre><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">The recommended cipher suite for backwards compatibility (IE6/WinXP):</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:142px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:ECDHE-RSA-AES128-GCM-SHA256:AES256+EECDH:DHE-RSA-AES128-GCM-SHA256:AES256+EDH:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";
</code></pre><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">If your version of OpenSSL is old, unavailable ciphers will be discarded automatically. Always use the full ciphersuite above and let OpenSSL pick the ones it supports.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The ordering of a ciphersuite is very important because it decides which algorithms are going to be selected in priority. The recommendation above prioritizes algorithms that provide perfect forward secrecy.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">Older versions of OpenSSL may not return the full list of algorithms. AES-GCM and some ECDHE are fairly recent, and not present on most versions of OpenSSL shipped with Ubuntu or RHEL.</p><h4 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:19px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Prioritization_logic">Prioritization logic</a></h4><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:180px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:40px;">ECDHE+AESGCM ciphers are selected first. These are TLS 1.2 ciphers. No known attack currently target these ciphers.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">PFS ciphersuites are preferred, with ECDHE first, then DHE.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:60px;">AES 128 is preferred to AES 256. There has been <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://www.mail-archive.com/dev-tech-crypto@lists.mozilla.org/msg11247.html">discussions</a> on whether AES256 extra security was worth the cost, and the result is far from obvious. At the moment, AES128 is preferred, because it provides good security, is really fast, and seems to be more resistant to timing attacks.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:40px;">In the backward compatible ciphersuite, AES is preferred to 3DES. BEAST attacks on AES are mitigated in TLS 1.1 and above, and difficult to achieve in TLS 1.0. In the non-backward compatible ciphersuite, 3DES is not present.</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">RC4 is removed entirely. 3DES is used for backward compatibility. See discussion in <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://wiki.mozilla.org/Security/Server_Side_TLS#RC4_weaknesses">#RC4_weaknesses</a></li></ul><h4 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:19px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Mandatory_discards">Mandatory discards</a></h4><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:160px;"><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:40px;">aNULL contains non-authenticated Diffie-Hellman key exchanges, that are subject to Man-In-The-Middle (MITM) attacks</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">eNULL contains null-encryption ciphers (cleartext)</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">EXPORT are legacy weak ciphers that were marked as exportable by US law</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">RC4 contains ciphers that use the deprecated ARCFOUR algorithm</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">DES contains ciphers that use the deprecated Data Encryption Standard</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">SSLv2 contains all ciphers that were defined in the old version of the SSL standard, now deprecated</li><li style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:810px;height:20px;">MD5 contains all the ciphers that use the deprecated message digest 5 as the hashing algorithm</li></ul><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Extra_settings">Extra settings</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">Make sure you also add these lines:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:62px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">ssl_prefer_server_ciphers on;
ssl_session_cache shared:SSL:10m;
</code></pre><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">When choosing a cipher during an SSLv3 or TLSv1 handshake, normally the client's preference is used. If this directive is enabled, the server's preference will be used instead.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://wiki.nginx.org/HttpSslModule#ssl_prefer_server_ciphers">More info on ssl<em style="box-sizing:border-box;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">prefer</em>server_ciphers</a><br style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/> <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="http://wiki.nginx.org/HttpSslModule#ssl_ciphers">More info on ssl_ciphers</a></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Forward_Secrecy_&amp;_Diffie_Hellman_Ephemeral_Parameters">Forward Secrecy &amp; Diffie Hellman Ephemeral Parameters</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:100px;">The concept of forward secrecy is simple: client and server negotiate a key that never hits the wire, and is destroyed at the end of the session. The RSA private from the server is used to sign a Diffie-Hellman key exchange between the client and the server. The pre-master key obtained from the Diffie-Hellman handshake is then used for encryption. Since the pre-master key is specific to a connection between a client and a server, and used only for a limited amount of time, it is called Ephemeral.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">With Forward Secrecy, if an attacker gets a hold of the server's private key, it will not be able to decrypt past communications. The private key is only used to sign the DH handshake, which does not reveal the pre-master key. Diffie-Hellman ensures that the pre-master keys never leave the client and the server, and cannot be intercepted by a MITM.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">All versions of nginx as of 1.4.4 rely on OpenSSL for input parameters to Diffie-Hellman (DH). Unfortunately, this means that Ephemeral Diffie-Hellman (DHE) will use OpenSSL's defaults, which include a 1024-bit key for the key-exchange. Since we're using a 2048-bit certificate, DHE clients will use a weaker key-exchange than non-ephemeral DH clients.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">We need generate a stronger DHE parameter:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:62px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">cd /etc/ssl/certs
openssl dhparam -out dhparam.pem 4096
</code></pre><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">And then tell nginx to use it for DHE key-exchange:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:42px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;">ssl_dhparam /etc/ssl/certs/dhparam.pem;
</code></pre><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="OCSP_Stapling">OCSP Stapling</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">When connecting to a server, clients should verify the validity of the server certificate using either a Certificate Revocation List (CRL), or an Online Certificate Status Protocol (OCSP) record. The problem with CRL is that the lists have grown huge and takes forever to download.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:80px;">OCSP is much more lightweight, as only one record is retrieved at a time. But the side effect is that OCSP requests must be made to a 3rd party OCSP responder when connecting to a server, which adds latency and potential failures. In fact, the OCSP responders operated by CAs are often so unreliable that browser will fail silently if no response is received in a timely manner. This reduces security, by allowing an attacker to DoS an OCSP responder to disable the validation.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">The solution is to allow the server to send its cached OCSP record during the TLS handshake, therefore bypassing the OCSP responder. This mechanism saves a roundtrip between the client and the OCSP responder, and is called OCSP Stapling.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">The server will send a cached OCSP response only if the client requests it, by announcing support for the status_request TLS extension in its CLIENT HELLO.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:60px;">Most servers will cache OCSP response for up to 48 hours. At regular intervals, the server will connect to the OCSP responder of the CA to retrieve a fresh OCSP record. The location of the OCSP responder is taken from the Authority Information Access field of the signed certificate.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/OCSP_Stapling_on_nginx.html">View my tutorial on enabling OCSP stapling on NGINX</a></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">When possible, you should enable <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HTTP Strict Transport Security (HSTS)</a>, which instructs browsers to communicate with your site only over HTTPS.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tutorials/HTTP_Strict_Transport_Security_for_Apache_NGINX_and_Lighttpd.html">View my article on HTST to see how to configure it.</a></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="HTTP_Public_Key_Pinning_Extension">HTTP Public Key Pinning Extension</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">You should also enable the <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://wiki.mozilla.org/SecurityEngineering/Public_Key_Pinning">HTTP Public Key Pinning Extension</a>.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:41px;">Public Key Pinning means that a certificate chain must include a whitelisted public key. It ensures only whitelisted Certificate Authorities (CA) can sign certificates for <code style="white-space:nowrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:2px 4px;color:rgb(199, 37, 78);font-size:90%;border-radius:0px;background-color:rgb(249, 242, 244);border:0px none rgb(199, 37, 78);background-image:none;box-shadow:none;">*.example.com</code>, and not any CA in your browser store.</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">I've written an article about it that has background theory and configuration examples for Apache, Lighttpd and NGINX: <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/articles/HTTP_Public_Key_Pinning_Extension_HPKP.html">https://raymii.org/s/articles/HTTP<em style="box-sizing:border-box;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">Public</em>Key<em style="box-sizing:border-box;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">Pinning</em>Extension_HPKP.html</a></p><h3 style="color:rgb(8, 8, 8);box-sizing:border-box;font-weight:300;line-height:20px;margin-top:10px;margin-bottom:10.5px;font-size:26px;padding-top:10px;font-family:inherit;text-rendering:optimizeLegibility;border:0px none rgb(8, 8, 8);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" name="Conclusion">Conclusion</a></h3><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">If you have applied the above config lines you need to restart nginx:</p><pre style="word-break:break-all;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;white-space:pre-wrap;box-sizing:border-box;display:block;padding:10px;margin:0px 0px 10.5px;line-height:1.42857;color:rgb(51, 51, 51);font-size:14px;word-wrap:break-word;border:1px solid rgb(204, 204, 204);border-radius:0px;background-color:rgb(245, 245, 245);background-image:none;box-shadow:none;width:850px;height:102px;"><code style="white-space:pre-wrap;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;box-sizing:border-box;padding:0px;color:inherit;font-size:inherit;border-radius:0px;background-color:rgba(0, 0, 0, 0);border:0px none rgb(51, 51, 51);background-image:none;box-shadow:none;"># Check the config first:
/etc/init.d/nginx configtest
# Then restart:
/etc/init.d/nginx restart
</code></pre><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:40px;">Now use the <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://www.ssllabs.com/ssltest/">SSL Labs test</a> to see if you get a nice A. And, of course, have a safe, strong and future proof SSL configuration!</p><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;"><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://wiki.mozilla.org/Security/Server_Side_TLS">Also read the Mozilla page on the subject</a></p></div><hr style="border-top-color:rgb(230, 230, 230);height:0px;margin-top:21px;margin-bottom:21px;border-width:1px 0px 0px;border-top-style:solid;box-sizing:border-box;border:;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"/>Tags: <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tags/nginx.html">nginx,</a><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tags/security.html">security,</a><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tags/ssl.html">ssl,</a><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tags/ssl-labs.html">ssl-labs,</a><a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/tags/tls.html">tls,</a><div style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:42px;"><hr style="border-top-color:rgb(230, 230, 230);height:0px;margin-top:21px;margin-bottom:21px;border-width:1px 0px 0px;border-top-style:solid;box-sizing:border-box;border:;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;"/><p style="box-sizing:border-box;margin:0px 0px 10.5px;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:850px;height:20px;">Generated by <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/software/ingsoc.html">ingsoc</a> | <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/software/Sparkling_Network.html">Cluster Status</a> | <a style="box-sizing:border-box;color:rgb(117, 204, 0);text-decoration:none;border:0px none rgb(117, 204, 0);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" href="https://raymii.org/s/static/About.html">About</a><br style="box-sizing:border-box;border:0px none rgb(85, 85, 85);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/></p></div></div></div></div></div></div></div></div></div><br/></div></body></html>